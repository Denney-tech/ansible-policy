version: 3

build_arg_defaults:
  ANSIBLE_GALAXY_CLI_COLLECTION_OPTS: '--pre'

dependencies:
  ansible_core:
    package_pip: ansible-core==2.14.4
  ansible_runner:
    package_pip: ansible-runner
  galaxy:
    collections:
      - community.general
  python:
    - six
    - psutil
  system:
    - sudo
    - ufw
  python_interpreter:
    python_path: "/usr/local/bin/python3"

images:
  base_image:
    # name: docker.io/redhat/ubi9:latest
    name: python:3.11

# additional_build_files:
#     - src: ansible.cfg
#       dest: configs

additional_build_steps:
  prepend_builder:
    - RUN apt update -y
  prepend_final:
    - RUN apt update -y
  append_final: |
    RUN useradd -m -s /bin/bash foo -u 501
    RUN passwd -d foo
    RUN usermod -aG sudo foo
    RUN echo "%sudo   ALL=(ALL)   NOPASSWD: ALL" >> /etc/sudoers
    RUN echo "foo:test"|chpasswd

options:
  package_manager_path: /usr/bin/apt